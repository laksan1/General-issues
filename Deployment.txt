Playbook.yaml - описывавет последовательность действий, который должен произвести ansible сервер с клиентом

# PUSH с локальной машины
# 1.NIKA_SERVER
-  docker build . -t registry.gitlab.com/in-delo/nikamissioncontrol/deploymentthings/nika-server:latest
-  docker tag nika-server registry.gitlab.com/in-delo/nikamissioncontrol/deploymentthings/nika-server:latest #Переименовать имя образа
-  docker push registry.gitlab.com/in-delo/nikamissioncontrol/deploymentthings/nika-server:latest # 1.0.0


# 2.NIKA_MOTION
-  docker build . -t registry.gitlab.com/in-delo/nikamissioncontrol/deploymentthings/nika-motion:latest
-  docker push registry.gitlab.com/in-delo/nikamissioncontrol/deploymentthings/nika-motion:latest


# PULL на VM

- cd /opt/nika/deployment

-  docker pull registry.gitlab.com/in-delo/nikamissioncontrol/deploymentthings/nika-motion:latest
-  docker pull registry.gitlab.com/in-delo/nikamissioncontrol/deploymentthings/nika-server:latest

- docker-compose up -d 
- Поменять версию latest на ...

#- /opt/nika/deployment  # папка compose

# Initial actions for VM
-Добавить запись А и сертификат в DNS

1. apt update && apt upgrade
2. git clone git@gitlab.com:in-delo/nikamissioncontrol/DeploymentThings.git
3. dig nika.we-on.com
4. dig nika.we-on.com @8.8.8.8 // Проверка на запись "A" в DNS
5. systemctl status nginx // Проверить статус nginx
6. docker ps
7. docker login registry.gitlab.com // Логин и пароль от гитлаба
8. docker-compose up -d // Запуск докера

# Import collection of mongo
1. winscp transfer backup to VM
2. goto ssh on VM (putty)
3. mongoimport --collection sessions_1 --jsonArray --type json --file /opt/nika/mongodb/dumps/userstatistics/demo_sessions.json --uri mongodb://localhost:27017/userstatistics
4. mongoimport --collection sessions --drop --jsonArray --type json --file /opt/nika/mongodb/dumps/userstatistics/sessions_new.json --uri mongodb://localhost:27017/userstatistics //DROP
4. mongoimport --collection characteristicsusers --drop --jsonArray --type json --file /opt/nika/mongodb/dumps/userstatistics/characteristicsusers_new.json --uri mongodb://localhost:27017/userstatistics //DROP
5. mongoimport --collection nikatimes --drop --jsonArray --type json --file /opt/nika/mongodb/dumps/userstatistics/nikatimes.json --uri mongodb://localhost:27017/userstatistics //DROP